% Representação do tabuleiro (os números são os índices da lista)
%
% 00|01|02|03  ||  04|05|06|07  ||  08|09|10|11  ||  12|13|14|15
% 16|17|18|19  ||  20|21|22|23  ||  24|25|26|27  ||  28|29|30|31
% 32|33|34|35  ||  36|37|38|39  ||  40|41|42|43  ||  44|45|46|47
% 48|49|50|51  ||  52|53|54|55  ||  56|57|58|59  ||  60|61|62|63`);


% ======== Win lines ========


% 2D Rows
win([Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.

% 2D Cols
win([Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.

% 2D Diags
win([Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.

% 3D Holes
win([Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.

% 3D Rows
win([Z1,_,_,_,_,Z2,_,_,_,_,Z3,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,Z1,_,_,Z2,_,_,Z3,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,Z2,_,_,_,_,Z3,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,Z2,_,_,Z3,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,Z2,_,_,_,_,Z3,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,Z2,_,_,Z3,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,Z2,_,_,_,_,Z3,_,_,_,_,Z4],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,Z2,_,_,Z3,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.

% 3D Cols
win([Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.

% 3D Diags
win([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.
win([Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4],P) :- Z1==P, Z2==P, Z3==P, Z4==P, !.


% ======== Open lines ======== 


% 2D Rows
open([Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,Z2,Z3,Z4],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).

% 2D Cols
open([Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).

% 2D Diags
open([Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).

% 3D Holes
open([Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,Z2,_,_,_,Z3,_,_,_,Z4],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).

% 3D Rows
open([Z1,_,_,_,_,Z2,_,_,_,_,Z3,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,Z1,_,_,Z2,_,_,Z3,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,Z2,_,_,_,_,Z3,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,Z2,_,_,Z3,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,Z2,_,_,_,_,Z3,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,Z2,_,_,Z3,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,Z2,_,_,_,_,Z3,_,_,_,_,Z4],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,Z2,_,_,Z3,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).

% 3D Cols
open([Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).

% 3D Diags
open([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,_,_,_,_,_,_,_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([_,_,_,Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4|_],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).
open([Z1,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z3,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,Z4],P) :- (var(Z1) | Z1==P), (var(Z2) | Z2==P), (var(Z3) | Z3==P), (var(Z4) | Z4==P).


%%%%%
%%  Move 
%%%%%
move(P, (0,0,0), [X1|R], [P|R]) :- var(X1).
move(P, (1,0,0), [X1,X2|R], [X1,P|R]) :- var(X2).
move(P, (2,0,0), [X1,X2,X3|R], [X1,X2,P|R]) :- var(X3).
move(P, (3,0,0), [X1,X2,X3,X4|R], [X1,X2,X3,P|R]) :- var(X4).
move(P, (0,0,1), [X1,X2,X3,X4,X5|R], [X1,X2,X3,X4,P|R]) :- var(X5).
move(P, (1,0,1), [X1,X2,X3,X4,X5,X6|R], [X1,X2,X3,X4,X5,P|R]) :- var(X6).
move(P, (2,0,1), [X1,X2,X3,X4,X5,X6,X7|R], [X1,X2,X3,X4,X5,X6,P|R]) :- var(X7).
move(P, (3,0,1), [X1,X2,X3,X4,X5,X6,X7,X8|R], [X1,X2,X3,X4,X5,X6,X7,P|R]) :- var(X8).
move(P, (0,0,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9|R], [X1,X2,X3,X4,X5,X6,X7,X8,P|R]) :- var(X9).
move(P, (1,0,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,P|R]) :- var(X10).
move(P, (2,0,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,P|R]) :- var(X11).
move(P, (3,0,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,P|R]) :- var(X12).
move(P, (0,0,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,P|R]) :- var(X13).
move(P, (1,0,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,P|R]) :- var(X14).
move(P, (2,0,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,P|R]) :- var(X15).
move(P, (3,0,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,P|R]) :- var(X16).
move(P, (0,1,0), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,P|R]) :- var(X17).
move(P, (1,1,0), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,P|R]) :- var(X18).
move(P, (2,1,0), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,P|R]) :- var(X19).
move(P, (3,1,0), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,P|R]) :- var(X20).
move(P, (0,1,1), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,P|R]) :- var(X21).
move(P, (1,1,1), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,P|R]) :- var(X22).
move(P, (2,1,1), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,P|R]) :- var(X23).
move(P, (3,1,1), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,P|R]) :- var(X24).
move(P, (0,1,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,P|R]) :- var(X25).
move(P, (1,1,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,P|R]) :- var(X26).
move(P, (2,1,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,P|R]) :- var(X27).
move(P, (3,1,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,P|R]) :- var(X28).
move(P, (0,1,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,P|R]) :- var(X29).
move(P, (1,1,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,P|R]) :- var(X30).
move(P, (2,1,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,P|R]) :- var(X31).
move(P, (3,1,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,P|R]) :- var(X32).
move(P, (0,2,0), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,P|R]) :- var(X33).
move(P, (1,2,0), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,P|R]) :- var(X34).
move(P, (2,2,0), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,P|R]) :- var(X35).
move(P, (3,2,0), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,P|R]) :- var(X36).
move(P, (0,2,1), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,P|R]) :- var(X37).
move(P, (1,2,1), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,P|R]) :- var(X38).
move(P, (2,2,1), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,P|R]) :- var(X39).
move(P, (3,2,1), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,P|R]) :- var(X40).
move(P, (0,2,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,P|R]) :- var(X41).
move(P, (1,2,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,P|R]) :- var(X42).
move(P, (2,2,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,P|R]) :- var(X43).
move(P, (3,2,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,P|R]) :- var(X44).
move(P, (0,2,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,P|R]) :- var(X45).
move(P, (1,2,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,P|R]) :- var(X46).
move(P, (2,2,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,P|R]) :- var(X47).
move(P, (3,2,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,P|R]) :- var(X48).
move(P, (0,3,0), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,P|R]) :- var(X49).
move(P, (1,3,0), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,P|R]) :- var(X50).
move(P, (2,3,0), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,P|R]) :- var(X51).
move(P, (3,3,0), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,P|R]) :- var(X52).
move(P, (0,3,1), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,P|R]) :- var(X53).
move(P, (1,3,1), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,P|R]) :- var(X54).
move(P, (2,3,1), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,P|R]) :- var(X55).
move(P, (3,3,1), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,P|R]) :- var(X56).
move(P, (0,3,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,P|R]) :- var(X57).
move(P, (1,3,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,X58|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,P|R]) :- var(X58).
move(P, (2,3,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,X58,X59|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,X58,P|R]) :- var(X59).
move(P, (3,3,2), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,X58,X59,X60|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,X58,X59,P|R]) :- var(X60).
move(P, (0,3,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,X58,X59,X60,X61|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,X58,X59,X60,P|R]) :- var(X61).
move(P, (1,3,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,X58,X59,X60,X61,X62|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,X58,X59,X60,X61,P|R]) :- var(X62).
move(P, (2,3,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,X58,X59,X60,X61,X62,X63|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,X58,X59,X60,X61,X62,P|R]) :- var(X63).
move(P, (3,3,3), [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,X58,X59,X60,X61,X62,X63,X64|R], [X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,X23,X24,X25,X26,X27,X28,X29,X30,X31,X32,X33,X34,X35,X36,X37,X38,X39,X40,X41,X42,X43,X44,X45,X46,X47,X48,X49,X50,X51,X52,X53,X54,X55,X56,X57,X58,X59,X60,X61,X62,X63,P|R]) :- var(X64).


%%%%%
%%  Generate possible marks on a free spot on the board.
%%  Use mark(+,+,-X,-Y) to query/generate possible moves (X,Y).
%%%%%
mark(P, [X|_],0,0,0) :- var(X), X=P.
mark(P, [_,X|_],1,0,0) :- var(X), X=P.
mark(P, [_,_,X|_],2,0,0) :- var(X), X=P.
mark(P, [_,_,_,X|_],3,0,0) :- var(X), X=P.
mark(P, [_,_,_,_,X|_],0,0,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,X|_],1,0,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,X|_],2,0,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,X|_],3,0,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,X|_],0,0,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,X|_],1,0,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,X|_],2,0,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,X|_],3,0,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,X|_],0,0,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],1,0,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],2,0,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],3,0,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],0,1,0) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],1,1,0) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],2,1,0) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],3,1,0) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],0,1,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],1,1,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],2,1,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],3,1,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],0,1,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],1,1,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],2,1,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],3,1,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],0,1,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],1,1,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],2,1,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],3,1,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],0,2,0) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],1,2,0) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],2,2,0) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],3,2,0) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],0,2,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],1,2,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],2,2,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],3,2,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],0,2,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],1,2,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],2,2,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],3,2,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],0,2,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],1,2,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],2,2,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],3,2,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],0,3,0) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],1,3,0) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],2,3,0) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],3,3,0) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],0,3,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],1,3,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],2,3,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],3,3,1) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],0,3,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],1,3,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],2,3,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],3,3,2) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],0,3,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],1,3,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],2,3,3) :- var(X), X=P.
mark(P, [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,X|_],3,3,3) :- var(X), X=P.
make_board([], 0):- !.
make_board([_|Board], I) :- I1 is I - 1, make_board(Board, I1).
make_board(Board) :- make_board(Board, 64). 

%%%%%
%% Calculate the value of a position, o maximizes, x minimizes.
%%%%%
value(Board,100) :- win(Board,o), !.
value(Board,-100) :- win(Board,x), !.
value(Board,E) :- 
    findall(o,open(Board,o),MAX), 
    length(MAX,Emax),      % # lines open to o
    findall(x,open(Board,x),MIN), 
    length(MIN,Emin),      % # lines open to x
    E is Emax - Emin.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% using minimax procedure with alpha-beta cutoff.
% Computer (o) searches for best tic tac toe move, 
% Human player is x.
% Adapted from L. Sterling and E. Shapiro, The Art of Prolog, MIT Press, 1986.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% O código abaixo foi modificado a partir do disponível em https://www.cpp.edu/~jrfisher/www/prolog_tutorial/5_3.html
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
alpha_beta(_Player,0,Position,_Alpha,_Beta,_NoMove,Value) :- 
   value(Position,Value).

alpha_beta(Player,D,Position,Alpha,Beta,Move,Value) :- 
   D > 0, 
   findall((X,Y,Z),mark(Player,Position,X,Y,Z),Moves), 
   Alpha1 is -Beta, % max/min
   Beta1 is -Alpha,
   D1 is D-1, 
   evaluate_and_choose(Player,Moves,Position,D1,Alpha1,Beta1,nil,(Move,Value)).

evaluate_and_choose(Player,[Move|Moves],Position,D,Alpha,Beta,Record,BestMove) :-
   move(Player,Move,Position,Position1), 
   other_player(Player,OtherPlayer),
   alpha_beta(OtherPlayer,D,Position1,Alpha,Beta,_OtherMove,Value),
   Value1 is -Value,
   cutoff(Player,Move,Value1,D,Alpha,Beta,Moves,Position,Record,BestMove).
evaluate_and_choose(_Player,[],_Position,_D,Alpha,_Beta,Move,(Move,Alpha)).

cutoff(_Player,Move,Value,_D,_Alpha,Beta,_Moves,_Position,_Record,(Move,Value)) :- 
   Value >= Beta, !.
cutoff(Player,Move,Value,D,Alpha,Beta,Moves,Position,_Record,BestMove) :- 
   Alpha < Value, Value < Beta, !, 
   evaluate_and_choose(Player,Moves,Position,D,Value,Beta,Move,BestMove).
cutoff(Player,_Move,Value,D,Alpha,Beta,Moves,Position,Record,BestMove) :- 
   Value =< Alpha, !, 
   evaluate_and_choose(Player,Moves,Position,D,Alpha,Beta,Record,BestMove).

other_player(o,x).
other_player(x,o).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% O código acima foi modificado a partir do disponível em https://www.cpp.edu/~jrfisher/www/prolog_tutorial/5_3.html
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

showBoard([], _).
showBoard([C|Board], I) :- M is I mod 16, M =:= 15, mark(C), writeln(''), I1 is I + 1, showBoard(Board, I1), !.
showBoard([C|Board], I) :- M is I mod 4, M =:= 3, mark(C), write('  ||  '), I1 is I + 1, showBoard(Board, I1), !.
showBoard([C|Board], I) :- mark(C), write('|'), I1 is I + 1, showBoard(Board, I1), !.

showBoard(Board) :- showBoard(Board, 0), (win(Board, x) -> format('~nX ganhou!~n',[]); (win(Board, o) -> format('~nO ganhou!~n',[]); (full(Board) -> writeln('Velha!')))), !.

full([]).
full([X|Xs]) :- \+var(X), full(Xs).

mark(X) :- 
   var(X),
   write('_').
mark(X) :- 
   \+var(X),
   write(X).



/* Eis um exemplo de codigo, eu pode ser usado tal qual, modificado e etc,
utilizando soquetes. E para utilizar no TP2!
PS. Funciona no gprolog, garantidamente, ams pode conter um pequeno erro (ainda!)
*/

/***********************************************************************
 * O tipo abstrato 'conexao' encapsula tudo o que eh necessario para a
 * comunicacao entre os dois adversarios. O soquete eh mantido para
 * fechar a conexao ao termino do jogo. Os 'streams' de entrada e
 * saida proveem os meios de comunicar com o adversario enviando as
 * proprias jogadas e recebendo as jogadas desde.
 *                                                                  
 * conexao(Soquete, Stream_entrada, Stream_saida).                     
 ***********************************************************************/


/***********************************************************************
 * conecta_adversario(+Nome_do_servidor, +Porto, -Conexao).
 *
 * Conecta com o servidor de nome e porto dados onde, supoem-se, um
 * adversario estara esperando por conexoes.
 ***********************************************************************/
conecta_adversario(Servidor, Porto, Conexao) :-
	tcp_socket(Soquete),
	tcp_connect(Soquete, Servidor:Porto), 
   tcp_open_socket(Soquete,Entrada,Saida),
        format(user_output,
               'Conectado com o servidor ~a na porta ~d.\n',
               [Servidor, Porto]),
	Conexao = conexao(Soquete, Entrada, Saida).
	

/***********************************************************************
 * espera_conexao(+Porto, -Conexao).
 *
 * Espera que um adversario conecte no porto dado para que possa ser
 * iniciada uma nova partida.
 ***********************************************************************/
espera_adversario(Porto, Conexao) :-
	tcp_socket(Soquete),
	tcp_bind(Soquete,Porto),
	tcp_listen(Soquete, 0),
   tcp_open_socket(Soquete, Entrada1, _),
   tcp_accept(Entrada1, SoqueteCliente, ip(P1,P2,P3,P4)),
   tcp_open_socket(SoqueteCliente,Entrada, Saida),
   %tcp_host_to_address(Cliente, EnderecoCliente),
        format(user_output,
               'Recebida conexao do cliente ~w.~w.~w.~w.\n',
               [P1,P2,P3,P4]),
	Conexao = conexao(Soquete, Entrada, Saida).	 


/***********************************************************************
 * envia(+Conexao, +Termo).
 *
 * Envia o termo dado para o adversario usando o 'stream' de saida
 * dado.
 ***********************************************************************/
envia(Saida, Termo) :-
	write(Saida, Termo),
	write(Saida, .),
	nl(Saida),
	flush_output(Saida).


/***********************************************************************
 * recebe_jogada(+Conexao, -Coordenada_X, +Coordenada_Y,
 *               +Coordenada_Z).
 *
 * Recebe a jogada do adversario ao qual se esta conectado atraves da
 * conexao dada nas coordenadas (X, Y, Z).
 ***********************************************************************/
recebe_jogada(Conexao, X, Y, Z) :-
	Conexao = conexao(_, Entrada, Saida),
        ((read(Entrada, jogada(X, Y, Z)), valida_jogada(X, Y, Z)) ->
           (envia(Saida, aceita), 
            format(user_output,
                   'Recebida jogada (~d, ~d, ~d).\n',
                   [X, Y, Z])
           )
        % O adversario enviou algo que nao eh uma jogada valida ou
 	% nem mesmo eh uma jogada.
	% Espera ate que uma jogada correta seja enviada.
         ; (envia(Saida,recusada),
            recebe_jogada(Conexao, X, Y, Z)
           )
	).


/***********************************************************************
 * valida_jogada(+X, +Y, +Z) (IMPLEMENTACAO EH ABSTRATA).
 *
 * Verifica se a jogada recebida ja foi proposta por um dos jogadores
 * em jogadas anteriores. Isso evita que por acidente, uma jogada seja
 * repetida em uma rodada posterior.
 ***********************************************************************/
valida_jogada(X, Y, Z) :-
	X >= 0, X =< 3,
	Y >= 0, Y =< 3,
	Z >= 0, Z =< 3.
	% Resto da verificacao vem aqui.


/***********************************************************************
 * envia_jogada(+Conexao, -Coordenada_X, +Coordenada_Y,
 *              +Coordenada_Z).
 *
 * Envia a jogada nas coordenadas (X, Y, Z) para o adversario ao qual
 * se esta conectado atraves da conexao dada.
 ***********************************************************************/
envia_jogada(Conexao, X, Y, Z) :-
        Conexao = conexao(_, Entrada, Saida),
	envia(Saida, jogada(X, Y, Z)),
	read(Entrada, Resposta),
	(Resposta = aceita    ->
           format(user_output,
                  'Jogada (~d, ~d, ~d) enviada com sucesso.\n',
                  [X, Y, Z])
	% O adversario informou que a jogada enviada nao eh coerente.
	% Ele continuara esperando o envio de uma jogada valida.
         ; Resposta = recusada -> fail
	% O adversario retornou algo que nao faz parte do protocolo.
	% Tente outra vez.
         ; envia_jogada(Conexao, X, Y, Z)
        ).

run_local_player(Conexao, Board) :- 
   alpha_beta(o,2,Board,-200,200,(X,Y,Z),_Value), 
   mark(o,Board,X,Y,Z), !,
   envia_jogada(Conexao, X, Y, Z).

run_remote_player(Conexao, Board) :-
   recebe_jogada(Conexao, X, Y, Z),
   mark(x,Board,X,Y,Z), !.

run_network_game(Conexao, Board, Player, RemotePlayer) :- (
   (showBoard(Board), !)
   ;(
      (Player = RemotePlayer -> run_remote_player(Conexao, Board); run_local_player(Conexao, Board)) -> (
         other_player(Player, NewPlayer),
         run_network_game(Conexao, Board, NewPlayer, RemotePlayer)
      ); (
         writeln('Movimento incorreto, tente novamente.\n'),
         run_network_game(Conexao, Board, Player, RemotePlayer)
      )
   )
).


network_game(Conexao, FirstPlayer, RemotePlayer) :- make_board(Board), run_network_game(Conexao, Board, FirstPlayer, RemotePlayer).

host_game(Porto) :- format('Seu jogador é o "O"!~nAguardando conexão na porta ~d...~n', [Porto]), espera_adversario(Porto, Conexao), writeln('Conectado!'), network_game(Conexao, x, o).
join_game(Servidor, Porto) :- conecta_adversario(Servidor, Porto, Conexao), network_game(Conexao, x, x).
